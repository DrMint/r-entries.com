---
import { getCollection } from "astro:content";
import Html from "../../components/Html.astro";
import TagPill from "../../components/TagPill.astro";

const posts = await getCollection("posts");
const tagNames = new Set(posts.flatMap((post) => post.data.tags ?? []));

const tags = [...tagNames].map((tag) => ({
  tag,
  count: posts.filter((post) => post.data.tags?.includes(tag)).length,
}));

// Sort from most prevalent to least
tags.sort((a, b) => b.count - a.count);
---

{/* --------------------------------[ HTML ]-------------------------------- */}

<Html>
  <main>
    <h1>Tags</h1>
    <div>
      {
        tags.map(({ tag, count }) => (
          <a href={`/tags/${tag}`}>
            <TagPill tag={tag} count={count} />
          </a>
        ))
      }
    </div>
  </main>
</Html>

{/* ---------------------------------[ CSS ]-------------------------------- */}

<style>
  main {
    max-width: 768px;
    width: 100%;
    margin-inline: auto;
    display: flex;
    flex-direction: column;
    gap: 1em;

    & > div {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
  }
</style>
