---
import Footer from "./Footer.astro";
import Header from "./Header.astro";
import MobileFooter from "./MobileFooter.astro";
import MobileHeader from "./MobileHeader.astro";

const props = Astro.props;

{
  /* --------------------------------[ HTML ]-------------------------------- */
}
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="R-Entries" />
    <link rel="manifest" href="/site.webmanifest" />

    <link rel="sitemap" href="/sitemap-index.xml" />

    <title>Document</title>
  </head>
  <body>
    <Header class="fine-only" />
    <MobileHeader class="coarse-only" />
    <main {...props}>
      <slot />
    </main>
    <Footer class="fine-only" />
    <MobileFooter class="coarse-only" />
  </body>
</html>

{/* ---------------------------------[ CSS ]-------------------------------- */}

<style>
  html {
    color-scheme: light dark;
    font-family: sans-serif;
    scroll-behavior: smooth;
  }

  html,
  body {
    padding: 0;
    margin: 0;

    color: var(--foreground);
    background-color: var(--background);
  }

  body {
    min-height: 100dvh;
    display: flex;
    flex-direction: column;

    @media (any-pointer: fine) {
      .coarse-only {
        display: none;
      }
    }

    @media (any-pointer: coarse) {
      .fine-only {
        display: none;
      }
    }
  }

  main {
    flex: 1;

    max-width: 1024px;
    width: 100%;
    margin-inline: auto;

    @media only screen and (min-width: 1024px) {
      border-inline: 1px solid var(--layout-border);
    }
  }
</style>

<style is:global>
  :root {
    --foreground: CanvasText;
    --background: Canvas;
    --foreground-3: color-mix(in srgb, var(--foreground) 3%, var(--background));
    --foreground-5: color-mix(in srgb, var(--foreground) 5%, var(--background));
    --foreground-10: color-mix(
      in srgb,
      var(--foreground) 10%,
      var(--background)
    );
    --foreground-20: color-mix(
      in srgb,
      var(--foreground) 20%,
      var(--background)
    );
    --foreground-30: color-mix(
      in srgb,
      var(--foreground) 30%,
      var(--background)
    );
    --foreground-50: color-mix(
      in srgb,
      var(--foreground) 50%,
      var(--background)
    );
    --foreground-60: color-mix(
      in srgb,
      var(--foreground) 60%,
      var(--background)
    );
    --background-70: color-mix(in srgb, var(--background) 70%, transparent);
    --layout-border: var(--foreground-20);
    --middle-x-padding: clamp(16px, 4vw, 48px);
  }

  .medium-zoom-overlay {
    backdrop-filter: blur(8px);
  }

  a {
    color: inherit;
    text-decoration: unset;
  }

  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: unset;
    line-height: 1;
  }

  * {
    box-sizing: border-box;
  }

  .prose {
    font-size: 18px;

    * {
      line-height: 1.5;
    }

    a {
      color: revert;
      text-decoration: revert;
    }

    & > *:first-child {
      margin-top: unset;
    }

    & > *:last-child {
      margin-bottom: unset;
    }

    h2,
    h3,
    h4,
    h5,
    h6 {
      margin-top: 2em;
      margin-bottom: 1em;
      scroll-margin-top: calc(56px + 2em);
    }

    h2 + h3,
    h3 + h4,
    h4 + h5,
    h5 + h6 {
      margin-top: -1em;
    }

    p {
      margin-top: 1em;
      margin-bottom: 1em;
    }

    ul,
    ol {
      margin-block: 0.75em;

      li + li {
        margin-top: 1em;
      }

      ::marker {
        color: var(--foreground-50);
      }
    }

    ul > li {
      padding-left: 3px;
    }

    ol > li {
      padding-left: 8px;
    }

    img {
      width: 100%;
      height: auto;

      border: 1px solid var(--layout-border);

      background-image: radial-gradient(
        var(--layout-border) 20%,
        transparent 30%
      );
      background-size: 12px 12px;
      background-repeat: space;
    }

    img + img {
      margin-top: 1em;
    }

    blockquote {
      border-left: 4px solid var(--foreground-30);
      margin-left: unset;
      padding: 0.5em 1em;
      background-color: var(--foreground-5);
      border-radius: 8px;
    }

    .astro-code {
      padding: 1em 1.5em;
      border-radius: 8px;
      white-space: unset;
      width: 100%;
    }

    :not(.astro-code) > code {
      background-color: var(--foreground-10);
      padding: 0.2em 0.5em;
      border-radius: 8px;
    }

    .anchor-link {
      color: var(--foreground-30);
      text-decoration: unset;
      margin-right: 8px;
      font-weight: 500;

      transition: color 100ms;

      &:hover,
      &:focus-visible {
        color: var(--foreground);
      }
    }
  }
</style>

<script>
  /* 
    Medium-like image zoom on post images.
    Only enabled when the window is larger than 720px. 
  */

  import mediumZoom from "medium-zoom";

  const zoom = mediumZoom(undefined, {
    margin: 50,
    background: "var(--background-70)",
  });

  const updateZoom = (smallerThan720: boolean) => {
    if (smallerThan720) {
      zoom.detach();
    } else {
      zoom.attach(".prose img");
    }
  };

  const mediaQuery = window.matchMedia("(max-width: 720px)");
  updateZoom(mediaQuery.matches);
  mediaQuery.addEventListener("change", ({ matches }) => updateZoom(matches));
</script>
