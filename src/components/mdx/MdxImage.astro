---
import { getImage } from "astro:assets";
import { Picture } from "astro:assets";

interface Props {
  src: ImageMetadata;
  alt: string;
  caption?: string | true;
}

const { src, alt, caption } = Astro.props;
const imageJpg = await getImage({ src, format: "jpg", width: 1920 });
const imageAvif = await getImage({ src, format: "avif", width: 1920 });
const imageWebp = await getImage({ src, format: "webp", width: 1920 });
---

{/* --------------------------------[ HTML ]-------------------------------- */}

{
  caption ? (
    <figure>
      <Picture
        src={src}
        alt={alt}
        widths={[320, 480, 610, 768, 1024, 1280]}
        sizes="(max-width: 650px) 100vw, 608.5px"
        formats={["avif", "webp", "jpg"]}
        class="enable-medium-zoom"
        data-zoom-jpg-src={imageJpg.src}
        data-zoom-avif-src={imageAvif.src}
        data-zoom-webp-src={imageWebp.src}
        fallbackFormat="jpg"
        width={600}
      />
      <figcaption>{caption === true ? alt : caption}</figcaption>
    </figure>
  ) : (
    <Picture
      src={src}
      alt={alt}
      widths={[320, 480, 610, 768, 1024, 1280]}
      sizes="(max-width: 650px) 100vw, 608.5px"
      formats={["avif", "webp", "jpg"]}
      class="enable-medium-zoom"
      data-zoom-jpg-src={imageJpg.src}
      data-zoom-avif-src={imageAvif.src}
      data-zoom-webp-src={imageWebp.src}
      fallbackFormat="jpg"
      width={600}
    />
  )
}

{/* ---------------------------------[ CSS ]-------------------------------- */}

<style>
  picture {
    width: 100%;
    aspect-ratio: 16/9;

    & > img {
      width: 100%;
      height: auto;
      object-fit: cover;
      border: 1px solid var(--layout-border);

      background-image: radial-gradient(
        var(--layout-border) 20%,
        transparent 30%
      );
      background-size: 12px 12px;
      background-repeat: space;
    }
  }

  figure {
    margin-inline: 0;
    margin-bottom: 2em;

    & > figcaption {
      margin-top: 0.5em;
      color: var(--foreground-60);
      text-align: center;
    }
  }
</style>
